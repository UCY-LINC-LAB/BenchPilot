FROM ubuntu:20.04

# install java
RUN apt-get update \
    && apt-get -y install openjdk-8-jdk \
    && rm -rf /var/lib/apt/lists/*

ENV JAVA_HOME /usr/lib/jvm/java-8-openjdk-amd64
ENV PATH $JAVA_HOME/bin:$PATH

# install required libraries
RUN apt-get update
RUN apt-get install -y vim
RUN apt-get install -y curl wget
RUN apt-get install -y git

# install python
RUN apt-get -y install python3 python3-pip
RUN python3 --version

# copy yahoo spark benchmark essentials
COPY src ./workload-client/src
WORKDIR /workload-client/src
COPY yahoo-streaming-workloads/yahoo-common ./
COPY yahoo-streaming-workloads/poms/pom-spark.xml ./pom.xml
COPY yahoo-streaming-workloads/workload-scripts/stream-bench-spark.sh ./stream-bench.sh
COPY yahoo-streaming-workloads/spark-benchmarks ./spark-benchmarks

# installing maven
RUN wget http://apache.mirror.iphh.net/maven/maven-3/3.6.3/binaries/apache-maven-3.6.3-bin.tar.gz -P /home
RUN tar xvfz /home/apache-maven-3.6.3-bin.tar.gz
RUN mv apache-maven-3.6.3 /opt/apache-maven-3.6.3
RUN curl https://raw.githubusercontent.com/technomancy/leiningen/stable/bin/lein > /home/lein
RUN mv /home/lein /usr/local/bin/lein
RUN chmod a+x /usr/local/bin/lein
RUN curl -O https://download.clojure.org/install/linux-install-1.10.2.774.sh > /home/linux-install-1.10.2.774.sh
RUN chmod +x /home/linux-install-1.10.2.774.sh
RUN /home/linux-install-1.10.2.774.sh
RUN chmod +x stream-bench.sh
ENV PATH=/opt/apache-maven-3.6.3/bin:$PATH
RUN ./stream-bench.sh SETUP

RUN pip3 install -r ./requirements.txt
CMD ["python3", "./main.py"]
